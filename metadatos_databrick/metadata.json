{
  "dataflows": [
    {
      "name": "df1_persons_employees",
      "sources": [
        {
          "name": "person_inputs",
          "path": "/Volumes/workspace/elt_modular/data/events/person/*",
          "format": "JSON" 
        },
        {
          "name": "employees_inputs",
          "path": "/Volumes/workspace/elt_modular/data/events/employees/*",
          "format": "JSON"
        }
      ],
      "transformations": [
        {
          "name": "validation_person",
          "type": "validate_fields",
          "params": { 
            "input": "person_inputs", 
            "validations": [
              {"field": "office", "validations": ["notEmpty"]},
              {"field": "age", "validations": ["notNull"]}
            ] 
          }
        },
        {
          "name": "person_ok_with_date",
          "type": "add_fields",
          "params": { 
            "input": "validation_person_ok", 
            "addFields": [{"name": "dt", "function": "current_timestamp"}]
          }
        }
      ],
      "bronze_sinks": [
        {
          "input": "person_inputs",
          "name": "workspace.elt_modular.bronze_person",
          "format": "DELTA",
          "saveMode": "overwrite"
        },
        {
          "input": "employees_inputs",
          "name": "workspace.elt_modular.bronze_employees",
          "format": "DELTA",
          "saveMode": "overwrite"
        }
      ],
      "silver_sinks": [
        {
          "input": "person_ok_with_date",
          "name": "workspace.elt_modular.silver_person_ok",
          "format": "DELTA",
          "saveMode": "overwrite"
        },
        {
          "input": "validation_person_ko",
          "name": "workspace.elt_modular.discards_person_ko",
          "format": "DELTA",
          "saveMode": "overwrite"
        }
      ]
    },
    {
      "name": "df2_polizas",
      "sources": [
        {
          "name": "polizas_inputs",
          "path": "/Volumes/workspace/elt_modular/data/events/polizas/*",
          "format": "JSON"
        }
      ],
      "transformations": [
        {
          "name": "validation_polizas",
          "type": "validate_fields",
          "params": {
            "input": "polizas_inputs",
            "validations": [
              {
                "field": "policy_id",
                "validations": ["notEmpty"]
              },
              {
                "field": "premium",
                "validations": ["notNull"]
              }
            ]
          }
        },
        {
          "name": "polizas_ok_with_date",
          "type": "add_fields",
          "params": {
            "input": "validation_polizas_ok",
            "addFields": [
              {
                "name": "dt_ingestion",
                "function": "current_timestamp"
              }
            ]
          }
        }
      ],
      "bronze_sinks": [
        {
          "input": "polizas_inputs",
          "name": "workspace.elt_modular.bronze_polizas",
          "format": "DELTA",
          "saveMode": "overwrite"
        }
      ],
      "silver_sinks": [
        {
          "input": "polizas_ok_with_date",
          "name": "workspace.elt_modular.silver_polizas_ok",
          "format": "DELTA",
          "saveMode": "overwrite"
        },
        {
          "input": "validation_polizas_ko",
          "name": "workspace.elt_modular.discards_polizas_ko",
          "format": "DELTA",
          "saveMode": "overwrite"
        }
      ]
    }
  ]
}
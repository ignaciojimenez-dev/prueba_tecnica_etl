# --- PLANTILLA YML.J2 (CORREGIDA) ---
# Usa 'sync.include:' y la ruta de tu workspace

bundle:
  name: "framework-dlt-generado"

# ¡Ruta REAL de tu proyecto en Databricks Repos!
workspace:
  root_path: "/Workspace/Users/ignaqwert00@gmail.com/prueba_tecnica_etl"

# ¡LA CORRECCIÓN ESTÁ AQUÍ!
# Usamos 'sync.include' para SINCRONIZAR ficheros .py
sync:
  include:
    - "src/dlt_helpers.py"
    - "pipelines_generadas/*.py" # Incluye todos los .py generados

targets:
  dev:
    mode: development
    default: true
    workspace: {} # Limpio y vacío
    
    resources:
      pipelines:
        dlt_df1_persons_employees:
          name: "DLT - df1_persons_employees"
          #development: true
          serverless: true
          libraries:
            # El path es ahora relativo al root_path de arriba
            - notebook: { path: "pipelines_generadas/dlt_df1_persons_employees.py" }
          #storage: "/Volumes/workspace/elt_modular_dlt/dlt_storage/df1_persons_employees"
          catalog: "workspace"
          schema: "elt_modular_dlt"
        dlt_df2_polizas:
          name: "DLT - df2_polizas"
          #development: true
          serverless: true
          libraries:
            # El path es ahora relativo al root_path de arriba
            - notebook: { path: "pipelines_generadas/dlt_df2_polizas.py" }
          #storage: "/Volumes/workspace/elt_modular_dlt/dlt_storage/df2_polizas"
          catalog: "workspace"
          schema: "elt_modular_dlt"

      jobs:
        mega_job_all_pipelines:
          name: "Mega Job - Todos los Dataflows"
          tasks:
            - task_key: "run_dlt_df1_persons_employees"
              description: "Ejecuta el pipeline DLT para df1_persons_employees"
              pipeline_task:
                pipeline_id: "${resources.pipelines.dlt_df1_persons_employees.id}"
              # Lógica de secuencia (Corregida)
            - task_key: "run_dlt_df2_polizas"
              description: "Ejecuta el pipeline DLT para df2_polizas"
              pipeline_task:
                pipeline_id: "${resources.pipelines.dlt_df2_polizas.id}"
              # Lógica de secuencia (Corregida)
              depends_on:
                - task_key: "run_dlt_df1_persons_employees"
